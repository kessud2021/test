name: Bootstrap Spigot Plugin (Gradle)

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  bootstrap:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Java 17
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: 17

      - name: Create Gradle build files
        run: |
          cat > settings.gradle <<'EOF'
          rootProject.name = 'spigot-plugin'
          EOF

          cat > build.gradle <<'EOF'
          plugins {
              id 'java'
          }

          group = 'com.example'
          version = '1.0.0'

          java {
              toolchain.languageVersion = JavaLanguageVersion.of(17)
          }

          repositories {
              mavenCentral()
              maven {
                  url = 'https://hub.spigotmc.org/nexus/content/repositories/snapshots/'
              }
          }

          dependencies {
              compileOnly 'org.spigotmc:spigot-api:1.20.4-R0.1-SNAPSHOT'
          }
          EOF

      - name: Generate Gradle Wrapper
        run: |
          gradle wrapper --gradle-version 8.6

      - name: Create plugin.yml
        run: |
          mkdir -p src/main/resources
          cat > src/main/resources/plugin.yml <<'EOF'
          name: ExamplePlugin
          version: 1.0.0
          main: com.example.plugin.Main
          api-version: 1.20
          EOF

      - name: Create Main plugin class
        run: |
          mkdir -p src/main/java/com/example/plugin
          cat > src/main/java/com/example/plugin/Main.java <<'EOF'
          package com.example.plugin;

          import org.bukkit.plugin.java.JavaPlugin;

          public final class Main extends JavaPlugin {

              @Override
              public void onEnable() {
                  getLogger().info("Plugin enabled");
              }

              @Override
              public void onDisable() {
                  getLogger().info("Plugin disabled");
              }
          }
          EOF

      - name: Commit generated files
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git add .
          git commit -m "chore: bootstrap spigot plugin (gradle)" || true
          git push
          group = 'com.example'
          version = '1.0.0'

          java {
              toolchain.languageVersion = JavaLanguageVersion.of(17)
          }

          repositories {
              mavenCentral()
              maven {
                  url = 'https://hub.spigotmc.org/nexus/content/repositories/snapshots/'
              }
          }

          dependencies {
              compileOnly 'org.spigotmc:spigot-api:1.20.4-R0.1-SNAPSHOT'
          }
          EOF

      - name: Create settings.gradle
        run: |
          echo "rootProject.name = 'spigot-plugin'" > settings.gradle

      - name: Create plugin.yml
        run: |
          mkdir -p src/main/resources
          cat > src/main/resources/plugin.yml <<'EOF'
          name: ExamplePlugin
          version: 1.0.0
          main: com.example.plugin.Main
          api-version: 1.20
          EOF

      - name: Create Main plugin class
        run: |
          mkdir -p src/main/java/com/example/plugin
          cat > src/main/java/com/example/plugin/Main.java <<'EOF'
          package com.example.plugin;

          import org.bukkit.plugin.java.JavaPlugin;

          public final class Main extends JavaPlugin {

              @Override
              public void onEnable() {
                  getLogger().info("Plugin enabled");
              }

              @Override
              public void onDisable() {
                  getLogger().info("Plugin disabled");
              }
          }
          EOF

      - name: Commit generated files
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git add .
          git commit -m "chore: bootstrap spigot plugin (gradle wrapper)" || true
          git push
